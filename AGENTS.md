# AGENTS.md

AI subagents used in this repository.  
Each subagent handles a specialized part of the MAKER-style workflow for safe, reliable, multi-step coding.

---

## Maker-Decomposer
Breaks a high-level task into small, atomic micro-steps.

### When to use
- Big features that require multi-file or multi-step coding.
- Refactors affecting large sections of the codebase.
- Any task where the main agent activates **MAKER mode**.

### Output rules
- Must return **only** a numbered Markdown list.
- Each item must describe **exactly one** atomic coding action.
- No code, no prose, no commentary.
- Steps should be small, predictable, and sequential.

### When NOT to use
- Tiny tasks that affect one file or one line.
- Simple edits, style tweaks, or formatting fixes.

---

## Maker-MicroCoder
Implements a single micro-step in an isolated code snippet.

### When to use
- Only after Maker-Decomposer defines micro-steps.
- For producing candidate implementations of one micro-step.

### Output rules
- Output must be **one fenced code block only**.
- No text, no comments outside the block.
- Stay strictly within the scope of the micro-step.
- Include imports if required for the snippet to stand alone.

### When NOT to use
- For whole features or large multi-step tasks.
- For rewriting whole modules.
- For describing architecture or planning.

---

## Maker-Checker
Validates a MicroCoder candidate and filters out invalid outputs.

### When to use
- For each candidate snippet generated by Maker-MicroCoder.
- Before any voting or selection happens.

### Pass criteria
- One valid fenced code block.
- Implements the micro-step faithfully.
- Correct names and API shapes.
- No hallucinated files or unrelated logic.
- Plausible syntax and correct language tag.

### Fail criteria
- Wrong task, wrong names, or wrong structure.
- Missing or multiple code blocks.
- Extra prose or broken formatting.
- Obvious syntax errors or incomplete logic.

### Output rules
- **PASS** + the original (or minimally cleaned) snippet  
- **FAIL: <reason>**

---

## Maker-Voter
Selects the best snippet among the Checker-approved candidates.

### When to use
- After Maker-Checker returns 1–3 PASSed candidates.
- When multiple candidate solutions exist for the same micro-step.

### Selection criteria (in order)
1. Faithfulness to the micro-step description.
2. Correct naming and structure.
3. Type safety and correctness.
4. Clarity and maintainability.
5. Minimal complexity.

### Output rules
- `CHOSEN: <index>`  
- Followed by the **chosen snippet exactly as-is**.

### When NOT to use
- When only one PASS candidate exists (select automatically).

---

## Workflow Summary

The MAKER workflow inside Verdent works as follows:

1. **Main Agent** evaluates the task.  
   - If it matches the MAKER Activation Rules (long, multi-file, critical), switch to MAKER mode.

2. **Maker-Decomposer** produces a list of micro-steps.

3. For each micro-step:
   - Run **Maker-MicroCoder** twice to generate two candidate snippets.
   - Pass each candidate to **Maker-Checker**.
   - Discard all FAIL candidates.
   - If 1+ PASS candidates remain, run **Maker-Voter** to select the best snippet.
   - Apply the chosen snippet to the codebase.

4. After all micro-steps are completed:
   - Run Verdent’s default **Verifier** and **Code-reviewer** to ensure final correctness.

---

## Notes
- MAKER mode is only activated for long-horizon, multi-file, or high-risk work.  
- For small tasks, the main agent should use normal single-path generation.  
- All subagents are strictly scoped and must not perform planning or multi-step reasoning outside their domain.

